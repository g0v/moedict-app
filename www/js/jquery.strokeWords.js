!function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x;q=this,r=q.sax||require("sax"),m=q.glMatrix||require("./gl-matrix-min"),i=function(a,b,c,d){var e;return q.window?jQuery.ajax({type:"GET",url:a,dataType:"text",progress:d}).done(b).fail(c):(e=require("fs"),e.readFile(a,{encoding:"utf8"},function(a,d){return a?c(a):b(d)}))},f=function(a,b,c,d){var e;return q.window?jQuery.ajax({type:"GET",url:a,dataType:"json",progress:d}).done(b).fail(c):(e=require("fs"),e.readFile(a,{encoding:"utf8"},function(a,d){return a?c(a):b(JSON.parse(d))}))},p=function(a,b,c){var d,e,f,g,h,i,j;return g=[],e=[],j=[],d=void 0,i=void 0,h=!0,f=r.parser(h),f.onopentag=function(a){if(void 0!==d)switch(a.name){case"MoveTo":return d.push({type:"M",x:parseFloat(a.attributes.x),y:parseFloat(a.attributes.y)});case"LineTo":return d.push({type:"L",x:parseFloat(a.attributes.x),y:parseFloat(a.attributes.y)});case"CubicTo":return d.push({type:"C",begin:{x:parseFloat(a.attributes.x1),y:parseFloat(a.attributes.y1)},mid:{x:parseFloat(a.attributes.x2),y:parseFloat(a.attributes.y2)},end:{x:parseFloat(a.attributes.x3),y:parseFloat(a.attributes.y3)}});case"QuadTo":return d.push({type:"Q",begin:{x:parseFloat(a.attributes.x1),y:parseFloat(a.attributes.y1)},end:{x:parseFloat(a.attributes.x2),y:parseFloat(a.attributes.y2)}})}else if(void 0!==i)switch(a.name){case"MoveTo":return i.push({x:parseFloat(a.attributes.x),y:parseFloat(a.attributes.y),size:a.attributes.size?parseFloat(a.attributes.size):void 0})}else if("Outline"===a.name&&(d=[]),"Track"===a.name)return i=[]},f.onclosetag=function(a){return"Outline"===a&&(e.push(d),d=void 0),"Track"===a?(j.push(i),i=void 0):void 0},f.onend=function(){var a,c,f;for(a=c=0,f=e.length;f>c;a=++c)d=e[a],i=j[a],g.push({outline:d,track:i});return b(g)},f.onerror=function(a){return c(a)},f.write(a).close()},h=function(a,b,c){return i(a,function(a){return p(a,b,c)},c)},l=function(a,b,c,d){var e;return e=new XMLHttpRequest,e.open("GET",a,!0),e.responseType="arraybuffer",e.onprogress=d,e.onreadystatechange=function(){return 4===this.readyState?200===this.status?"function"==typeof b?b(this.response):void 0:"function"==typeof c?c(this.status):void 0:void 0},e.send()},w=function(a){var b,c,d,e;for(c=[a[0]],b=d=1,e=a.length;e>=1?e>d:d>e;b=e>=1?++d:--d)c.push((c[b-1]+a[b]+256)%256);return c},x=function(a,b){var c;return c=0!==a.length?a[a.length-1]:0,a.concat([(c+b+256)%256])},s=function(a){return 2060*a/256},o=function(a,b,c,d){var e,f,g,h,i,j,k,l,m,n,o,p,q,r,t,u,v,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P;for(q={M:1,L:1,Q:2,C:3},h=new DataView(a),v=h.getUint16(0,!0),i=C=0;v>=0?v>C:C>v;i=v>=0?++C:--C)if(j=h.getUint16(2+6*i,!0),j===b){m=h.getUint32(2+6*i+2,!0);break}if(i===v)return"function"==typeof d?d(new Error("stroke not found")):void 0;for(o=0,p=[],x=h.getUint8(m+o++),D=0;x>=0?x>D:D>x;x>=0?D++:D--){for(n=[],f=h.getUint8(m+o++),g=0,E=0;f>=0?f>E:E>f;f>=0?E++:E--)e={type:String.fromCharCode(h.getUint8(m+o++))},g+=q[e.type],n.push(e);for(A=[],B=[],F=0;g>=0?g>F:F>g;g>=0?F++:F--)A.push(h.getUint8(m+o++));for(I=0;g>=0?g>I:I>g;g>=0?I++:I--)B.push(h.getUint8(m+o++));for(A=w(A).map(s),B=w(B).map(s),l=0,J=0,G=n.length;G>J;J++)switch(e=n[J],e.type){case"M":e.x=A[l],e.y=B[l++];break;case"L":e.x=A[l],e.y=B[l++];break;case"Q":e.begin={x:A[l],y:B[l++]},e.end={x:A[l],y:B[l++]};break;case"C":e.begin={x:A[l],y:B[l++]},e.mid={x:A[l],y:B[l++]},e.end={x:A[l],y:B[l++]}}for(y=[],z=h.getUint8(m+o++),r=[],t=h.getUint8(m+o++),K=0;t>=0?t>K:K>t;t>=0?K++:K--)r.push(h.getUint8(m+o++));for(A=[],B=[],u=[],L=0;z>=0?z>L:L>z;z>=0?L++:L--)A.push(h.getUint8(m+o++));for(M=0;z>=0?z>M:M>z;z>=0?M++:M--)B.push(h.getUint8(m+o++));for(N=0;t>=0?t>N:N>t;t>=0?N++:N--)u.push(h.getUint8(m+o++));for(A=w(A).map(s),B=w(B).map(s),u=u.map(s),l=O=0;z>=0?z>O:O>z;l=z>=0?++O:--O)y.push({x:A[l],y:B[l]});for(l=0,P=0,H=r.length;H>P;P++)k=r[P],y[k].size=u[l++];p.push({outline:n,track:y})}return"function"==typeof c?c(p):void 0},a=function(){var a;return a={},{get:function(b){var c,d,e;return d=b.substr(b.length-6,2),e=""+b.substr(0,6)+d+".bin",void 0===a[d]&&(c=jQuery.Deferred(),l(e,function(a){return c.resolve(a)},function(a){return c.reject(a)},function(a){return c.notify(a)}),a[d]=c),a[d]}}},e=a(),g=function(a,b,c,d){var f;return q.window?(f=parseInt(a.substr(6,a.length-12),16),e.get(a).done(function(a){return o(a,f,b,c)}).fail(c).progress(d)):console.log("not implemented")},c=void 0,k=Array.prototype.forEach,t=function(a){var b,c,d;for(c=[];a.length;)/[\uD800-\uDBFF]/.test(a.substr(0,1))?(d=a.substr(0,2),b=1024*(d.charCodeAt(0)-55296)+d.charCodeAt(1)-56320+65536,c.push({cp:b.toString(16),text:d}),a=a.substr(2)):(c.push({cp:a.charCodeAt(0).toString(16),text:a.substr(0,1)}),a=a.substr(1));return c},u=function(a,b,c){var d,e,f;return f=m.vec2.clone([b,c]),d=m.mat2d.clone(a),e=m.vec2.create(),m.vec2.transformMat2d(e,f,d),{x:e[0],y:e[1]}},v=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q;for(g=[],j=0,m=a.length;m>j;j++){for(h=a[j],e={outline:[],track:[]},p=h.outline,k=0,n=p.length;n>k;k++)switch(c=p[k],c.type){case"M":f=u(b,c.x,c.y),e.outline.push({type:c.type,x:f.x,y:f.y});break;case"L":f=u(b,c.x,c.y),e.outline.push({type:c.type,x:f.x,y:f.y});break;case"C":d={type:c.type},f=u(b,c.begin.x,c.begin.y),d.begin={x:f.x,y:f.y},f=u(b,c.mid.x,c.mid.y),d.mid={x:f.x,y:f.y},f=u(b,c.end.x,c.end.y),d.end={x:f.x,y:f.y},e.outline.push(d);break;case"Q":d={type:c.type},f=u(b,c.begin.x,c.begin.y),d.begin={x:f.x,y:f.y},f=u(b,c.end.x,c.end.y),d.end={x:f.x,y:f.y},e.outline.push(d)}for(q=h.track,l=0,o=q.length;o>l;l++)i=q[l],f=u(b,i.x,i.y),e.track.push({x:f.x,y:f.y});g.push(e)}return g},j={xml:h,json:f,bin:g},b=function(){var a;return a={},{get:function(b,c,d){var e;return void 0===a[b]&&(e=jQuery.Deferred(),j[d](""+c+b+"."+d,function(a){return e.resolve(a)},function(a){return e.reject(a)},function(a){return e.notify(a)}),a[b]=e),a[b]}}},n=b(),c=function(a){var b;return a=$.extend({url:"./json/",dataType:"json"},a),b={transform:v,get:function(b,c,d,e){return n.get(b,a.url,a.dataType).done(c).fail(d).progress(e)}}},q.window?(window.WordStroker||(window.WordStroker={}),window.WordStroker.utils={sortSurrogates:t,StrokeData:c,fetchStrokeXml:i,fetchStrokeJSON:f,fetchStrokeJSONFromXml:h}):(d={utils:{sortSurrogates:t,StrokeData:c,fetchStrokeXml:i,fetchStrokeJSON:f,fetchStrokeJSONFromXml:h}},module.exports=d)}.call(this),function(){$(function(){var a,b,c,d,e;return c=function(a){var b,c,d,e;for(c=[],d=0,e=a.length;e>d;d++)b=a[d],1===b.nodeType&&c.push(b);return c},a=function(a,b,c){var d,e,f,g,h,i;for(f=[],i=b.childNodes,g=0,h=i.length;h>g;g++)if(e=i[g],1===e.nodeType&&(d=e.attributes))switch(e.nodeName){case"MoveTo":f.push(["M",parseFloat(d.x.value),parseFloat(d.y.value)]);break;case"LineTo":f.push(["L",parseFloat(d.x.value),parseFloat(d.y.value)]);break;case"CubicTo":f.push(["C",parseFloat(d.x1.value),parseFloat(d.y1.value),parseFloat(d.x2.value),parseFloat(d.y2.value),parseFloat(d.x3.value),parseFloat(d.y3.value)]);break;case"QuadTo":f.push(["Q",parseFloat(d.x1.value),parseFloat(d.y1.value),parseFloat(d.x2.value),parseFloat(d.y2.value)])}return a.path(f).attr(c).transform("s0.2,0.2,0,0")},b=function(a,b){return $.get("utf8/"+a.toLowerCase()+".xml",b,"xml")},d=function(c,d){var e;return e=escape(d).replace(/%u/,""),b(e,function(b){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r;for(f=430,j=Raphael(c,f,f),g=["M0,0 L0,"+f,"M"+f+",0 L"+f+","+f,"M0,0 L"+f+",0","M0,"+f+",0 L"+f+","+f,"M"+Math.round(f/3)+",0 L"+Math.round(f/3)+","+f,"M"+Math.round(2*(f/3))+",0 L"+Math.round(2*(f/3))+","+f,"M0,"+Math.round(f/3)+" L"+f+","+Math.round(f/3),"M0,"+Math.round(2*(f/3))+" L"+f+","+Math.round(2*(f/3))],m=0,o=g.length;o>m;m++)h=g[m],j.path(h).attr({"stroke-width":1,stroke:"#a33"});for(Raphael.getColor(),Raphael.getColor(),d=Raphael.getColor(),k={stroke:d,"stroke-width":5,"stroke-linecap":"round",fill:d},l=0,e=500,q=b.getElementsByTagName("Outline"),r=[],n=0,p=q.length;p>n;n++)i=q[n],r.push(function(b){return setTimeout(function(){return a(j,b,k)},l+=e)}(i));return r})},e=function(a,b){var c,e,f,g,h;for(g=b.split(/(?:)/),h=[],e=0,f=g.length;f>e;e++)c=g[e],h.push(d(a,c));return h},window.WordStroker||(window.WordStroker={}),window.WordStroker.raphael={strokeWords:e}})}.call(this),function(){$(function(){var a,b,c,d,e,f,g;return f={dim:2150,trackWidth:150},b=[1,0,0,1,100,100],a=function(a){var b;return this.options=$.extend({scales:{fill:.4,style:.25},updatesPerStep:10,delays:{stroke:.25,word:.5},progress:null,url:"./",dataType:"json"},a,f),this.matrix=[this.options.scales.fill,0,0,this.options.scales.fill,0,0],this.myCanvas=document.createElement("canvas"),b=$(this.myCanvas),b.css("width",this.styleWidth()+"px"),b.css("height",this.styleHeight()+"px"),this.myCanvas.width=this.fillWidth(),this.myCanvas.height=this.fillHeight(),this.canvas=this.myCanvas,this},a.prototype.init=function(){return this.currentStroke=0,this.currentTrack=0,this.time=0},a.prototype.width=function(){return this.options.dim},a.prototype.height=function(){return this.options.dim},a.prototype.fillWidth=function(){return this.width()*this.options.scales.fill},a.prototype.fillHeight=function(){return this.height()*this.options.scales.fill},a.prototype.styleWidth=function(){return this.fillWidth()*this.options.scales.style},a.prototype.styleHeight=function(){return this.fillHeight()*this.options.scales.style},a.prototype.drawBackground=function(a){var b;return this.canvas=a?a:this.myCanvas,b=this.canvas.getContext("2d"),b.fillStyle="#FFF",b.fillRect(0,0,this.fillWidth(),this.fillHeight()),c(b,this.fillWidth())},a.prototype.draw=function(a,b){var c,d=this;return this.init(),this.strokes=a,this.canvas=b?b:this.myCanvas,c=this.canvas.getContext("2d"),c.strokeStyle="#000",c.fillStyle="#000",c.lineWidth=5,requestAnimationFrame(function(){return d.update()}),this.promise=$.Deferred()},a.prototype.update=function(){var a,b,c,d,e,f,h=this;if(!(this.currentStroke>=this.strokes.length)){for(a=this.canvas.getContext("2d"),a.setTransform.apply(a,this.matrix),d=this.strokes[this.currentStroke],0===this.time&&(this.vector={x:d.track[this.currentTrack+1].x-d.track[this.currentTrack].x,y:d.track[this.currentTrack+1].y-d.track[this.currentTrack].y,size:d.track[this.currentTrack].size||this.options.trackWidth},a.save(),a.beginPath(),g(a,d.outline),a.clip()),c=e=1,f=this.options.updatesPerStep;(f>=1?f>=e:e>=f)&&(this.time+=.02,this.time>=1&&(this.time=1),a.beginPath(),a.arc(d.track[this.currentTrack].x+this.vector.x*this.time,d.track[this.currentTrack].y+this.vector.y*this.time,2*this.vector.size,0,2*Math.PI),a.fill(),!(this.time>=1));c=f>=1?++e:--e);return b=0,this.time>=1&&(a.restore(),this.time=0,this.currentTrack+=1),this.currentTrack>=d.track.length-1&&(this.currentTrack=0,this.currentStroke+=1,b=this.options.delays.stroke),this.currentStroke>=this.strokes.length?setTimeout(function(){return h.promise.resolve()},1e3*this.options.delays.word):b?setTimeout(function(){return requestAnimationFrame(function(){return h.update()})},1e3*b):requestAnimationFrame(function(){return h.update()})}},c=function(a,b){return a.strokeStyle="#A33",a.beginPath(),a.lineWidth=10,a.moveTo(0,0),a.lineTo(0,b),a.lineTo(b,b),a.lineTo(b,0),a.lineTo(0,0),a.stroke(),a.beginPath(),a.lineWidth=2,a.moveTo(0,b/3),a.lineTo(b,b/3),a.moveTo(0,2*(b/3)),a.lineTo(b,2*(b/3)),a.moveTo(b/3,0),a.lineTo(b/3,b),a.moveTo(2*(b/3),0),a.lineTo(2*(b/3),b),a.stroke()},g=function(a,b){var c,d,e,f;for(f=[],d=0,e=b.length;e>d;d++)switch(c=b[d],c.type){case"M":f.push(a.moveTo(c.x,c.y));break;case"L":f.push(a.lineTo(c.x,c.y));break;case"C":f.push(a.bezierCurveTo(c.begin.x,c.begin.y,c.mid.x,c.mid.y,c.end.x,c.end.y));break;case"Q":f.push(a.quadraticCurveTo(c.begin.x,c.begin.y,c.end.x,c.end.y));break;default:f.push(void 0)}return f},d=function(b,c,d){var e,f,g,h,i;return d||(d={}),i=new a(d),f=$('<div class="word"></div>'),e=$('<div class="loader"><div style="width: 0"></div><i class="icon-spinner icon-spin icon-large icon-fixed-width"></i></div>'),f.append(i.canvas),$(b).append(f),g=WordStroker.utils.StrokeData({url:d.url,dataType:d.dataType}),h=jQuery.Deferred(),{promise:h,load:function(){return f.append(e),g.get(c.cp,function(a){return e.remove(),h.resolve({drawBackground:function(){return i.drawBackground()},draw:function(){return i.draw(a)},remove:function(){return $(i.canvas).remove()}})},function(){return e.remove(),h.resolve({drawBackground:function(){return i.drawBackground()},draw:function(){var a;return a=jQuery.Deferred(),$(i.canvas).fadeTo("fast",.5,function(){return a.resolve()}),a},remove:function(){return $(i.canvas).remove()}})},function(a){return a.lengthComputable&&e.find("> div").css("width",100*(a.loaded/a.total)+"%"),h.notifyWith(a,[a,c.text])}),h}}},e=function(a,b,c){return WordStroker.utils.sortSurrogates(b).map(function(b){return d(a,b,c)})},window.WordStroker||(window.WordStroker={}),window.WordStroker.canvas={Word:a,drawElementWithWords:e}})}.call(this),function(){var a,b;b=function(){var a;return null!=(a=document.createElement("canvas"))?a.getContext("2d"):void 0},a=jQuery,a.fn.extend({strokeWords:function(c,d){return void 0===c||""===c?null:(d=a.extend({single:!1,pool_size:4,svg:!b(),progress:null},d),this.each(function(){var a,b,e,f;return d.svg?window.WordStroker.raphael.strokeWords(this,c):(f=window.WordStroker.canvas.drawElementWithWords(this,c,d),a=0,e=0,(b=function(){var b;for(b=[];a<f.length&&e<d.pool_size;)++e,b.push(f[a++].load().progress(d.progress).then(function(a){return a.drawBackground()}));return b})(),f.reduceRight(function(a,c){return function(){return c.promise.then(function(c){return c.draw().then(function(){return--e,b(),d.single&&c.remove(),"function"==typeof a?a():void 0})})}},null)())}).data("strokeWords",{play:null}))}})}.call(this);